@page "/customers/create"
@inject NavigationManager Navigation
@inject IUIPersonalizationService UIPersonalizationService

<PageTitle>Create Customer - Control Painel CRM</PageTitle>

<MudBreadcrumbs Items="_breadcrumbItems" />

<MudText Typo="Typo.h3" GutterBottom="true">Create New Customer</MudText>

<MudPaper Class="pa-4 ma-2">
    <CustomerForm Customer="@_customer" 
                  IsEditMode="false"
                  OnSave="@OnCustomerSaved"
                  OnCancel="@OnCancel" />
</MudPaper>

@code {
    private Customer _customer = new();
    private List<BreadcrumbItem> _breadcrumbItems = new();

    protected override async Task OnInitializedAsync()
    {
        await UIPersonalizationService.LogAccessAsync("Create Customer Page Viewed");
        
        _breadcrumbItems = new List<BreadcrumbItem>
        {
            new BreadcrumbItem("Dashboard", href: "/", icon: Icons.Material.Filled.Home),
            new BreadcrumbItem("Customers", href: "/customers", icon: Icons.Material.Filled.People),
            new BreadcrumbItem("Create Customer", href: null, disabled: true, icon: Icons.Material.Filled.Add)
        };
    }

    private async Task OnCustomerSaved(Customer customer)
    {
        await UIPersonalizationService.LogAccessAsync("Customer Created", customer.DisplayName);
        Navigation.NavigateTo("/customers");
    }

    private void OnCancel()
    {
        Navigation.NavigateTo("/customers");
    }
}
